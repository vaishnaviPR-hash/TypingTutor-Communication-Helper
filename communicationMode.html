<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Communication Mode</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
/* ===== General Reset & Layout ===== */

body, html {
  height: 100%;
  width: 100%;
  margin: 0; padding: 0;
  font-family: 'Arial', sans-serif;
  overflow: hidden;
  box-sizing: border-box;
}

* {
  box-sizing: inherit;
}

/* ===== Main container & layout ===== */

.main-container {
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  padding: 0;
}

.mode-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ===== Text Display Section ===== */

.text-display-section {
  flex: 0 0 auto;
  display: flex;
  flex-direction: row;
  padding: 20px 15px;
  border-bottom: 4px solid;
  gap: 15px;
  align-items: stretch;
  max-height: 25vh;
  min-height: 80px;
  overflow: hidden;
  box-sizing: border-box;
}

.typed-content {
  flex: 1 1 auto;
  font-size: 4.5vw; /* responsive font size relative to viewport width */
  font-weight: bold;
  line-height: 1.2;
  word-wrap: break-word;
  overflow-y: auto;
  padding: 12px;
  border-radius: 16px;
  border: 3px solid;
  max-height: 100%;
  box-sizing: border-box;
  min-height: 50px;
}

/* ===== Control Bar ===== */

.control-bar {
  display: flex;
  flex-direction: column;
  gap: 12px;
  justify-content: center;
}

.control-btn {
  width: 70px;
  height: 70px;
  font-size: 32px;
  border: 3px solid;
  border-radius: 12px;
  cursor: pointer;
  transition: transform 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.control-btn:hover {
  transform: scale(1.05);
}

.control-btn:active {
  transform: scale(0.98);
}

.control-btn:focus {
  outline: 5px solid #4a90e2;
  outline-offset: 3px;
}

/* ===== Keyboard Section ===== */

.keyboard-section {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 10px 10px 15px;
  overflow: hidden;
  box-sizing: border-box;
  max-height: 70vh;
  min-height: 150px;
  width: 100%;
}

.keyboard-grid {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 100%;
  max-width: 100%;
  height: 100%;
  justify-content: center;
  box-sizing: border-box;
  padding-bottom: 5px; /* prevent scrollbar overlap */
}

.key-row {
  display: flex;
  gap: 24px;          /* Slightly smaller gap */
  justify-content: center;
  flex-wrap: wrap;    /* Allow wrapping to avoid overflow */
  flex-grow: 1;
  min-height: 40px;
  max-width: 100%;    /* Ensure max width stays within container */
  box-sizing: border-box;
}


.key-btn {
  flex-grow: 1;
  flex-shrink: 1;
  flex-basis: 60px;
  min-width: 40px;
  max-width: 120px;
  height: 60px;
  font-size: 4vw;
  font-weight: bold;
  border: 3px solid;
  border-radius: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s ease;
  user-select: none;
  box-sizing: border-box;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 6px;
}

.key-btn:hover {
  transform: scale(1.06);
}

.key-btn:active {
  transform: scale(0.96);
}

.key-btn:focus {
  outline: 5px solid #4a90e2;
  outline-offset: 3px;
}

.key-btn.space-key {
  flex-grow: 3;
  max-width: 300px;
}

.key-btn.backspace-key {
  flex-grow: 2;
  max-width: 180px;
  font-size: 3vw;
}

/* ===== Animations ===== */

.key-btn.pressed-animation {
  transform: scale(0.94);
}

/* ===== Media Queries ===== */

/* Phones and small devices */
@media (max-width: 600px) {
  .text-display-section {
    max-height: 20vh;
    padding: 10px 8px;
  }

  .typed-content {
    font-size: 6vw;
    min-height: 40px;
    max-height: 100%;
  }

  .control-btn {
    width: 50px;
    height: 50px;
    font-size: 20px;
  }

  .key-row {
    gap: 12px;
  }

  .key-btn {
    flex-basis: 40px;
    min-width: 35px;
    max-width: 80px;
    height: 45px;
    font-size: 5vw;
  }

  .key-btn.space-key {
    max-width: 180px;
    flex-grow: 3;
  }

  .key-btn.backspace-key {
    max-width: 110px;
    font-size: 4vw;
  }
}

/* Tablets in landscape and phones in landscape */
@media (max-width: 900px) and (orientation: landscape) {
  .text-display-section {
    max-height: 15vh;
    padding: 8px 12px;
  }

  .typed-content {
    font-size: 5vw;
  }

  .control-btn {
    width: 55px;
    height: 55px;
    font-size: 22px;
  }

  .key-btn {
    flex-basis: 50px;
    min-width: 40px;
    max-width: 90px;
    height: 50px;
    font-size: 4.5vw;
  }

  .key-btn.space-key {
    max-width: 220px;
  }

  .key-btn.backspace-key {
    max-width: 140px;
    font-size: 3.5vw;
  }
}

/* Tablets and small laptops */
@media (min-width: 601px) and (max-width: 1200px) {
  .typed-content {
    font-size: 3vw;
  }

  .key-btn {
    flex-basis: 70px;
    min-width: 60px;
    max-width: 140px;
    height: 65px;
    font-size: 3.5vw;
  }

  .key-btn.space-key {
    max-width: 300px;
  }

  .key-btn.backspace-key {
    max-width: 180px;
    font-size: 2.5vw;
  }
}    
</style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <main class="main-container" id="mainContainer">
   <div class="mode-content active" id="communicationMode">
    <section class="text-display-section" id="displaySection" aria-label="Text Display">
     <div class="typed-content" id="typedContent" role="textbox" aria-live="polite" aria-label="Your typed text"></div>
     <nav class="control-bar" aria-label="Controls"><button class="control-btn" id="speakBtn" aria-label="Speak text aloud">üîä</button>  <button class="control-btn" id="clearBtn" aria-label="Clear all text">üóëÔ∏è</button>
     </nav>
    </section>
    <section class="keyboard-section" id="keyboardSection" aria-label="Keyboard">
     <div class="keyboard-grid">
      <div class="key-row" id="row1" role="group" aria-label="Row 1"></div>
      <div class="key-row" id="row2" role="group" aria-label="Row 2"></div>
      <div class="key-row" id="row3" role="group" aria-label="Row 3"></div>
      <div class="key-row" id="row4" role="group" aria-label="Row 4"></div>
      <div class="key-row" id="row5" role="group" aria-label="Row 5"></div>
      <div class="key-row" id="row6" role="group" aria-label="Row 6"></div>
     </div>
    </section>
   </div>
  </main>
  <script>
    const defaultConfig = {
      background_color: '#e3f2fd',
      surface_color: '#ffffff',
      text_color: '#1a237e',
      primary_action_color: '#64b5f6',
      secondary_action_color: '#90caf9',
      font_family: 'Arial',
      font_size: 16,
      clear_button_text: 'Clear',
      sound_toggle_on: 'Sound: ON',
      sound_toggle_off: 'Sound: OFF',
      speak_button_text: 'Speak'
    };

    let soundEnabled = true;
    let currentText = '';

const keyboardLayout = [
  ['A', 'B', 'C', 'D', 'E'],
  ['F', 'G', 'H', 'I', 'J'],
  ['K', 'L', 'M', 'N', 'O'],
  ['P', 'Q', 'R', 'S', 'T'],
  ['U', 'V', 'W', 'X', 'Y'],
  ['Z', 'SPACE', 'BACKSPACE']
];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const speechSynth = window.speechSynthesis;

    const letterPhonetics = {
      'A': 'a', 'B': 'bee', 'C': 'see', 'D': 'dee', 'E': 'ee',
      'F': 'eff', 'G': 'dgee', 'H': 'aitch', 'I': 'eye', 'J': 'jay',
      'K': 'kay', 'L': 'ell', 'M': 'em', 'N': 'en', 'O': 'oh',
      'P': 'pee', 'Q': 'cue', 'R': 'are', 'S': 'ess', 'T': 'tee',
      'U': 'you', 'V': 'vee', 'W': 'double you', 'X': 'ex', 'Y': 'why',
      'Z': 'zee'
    };

    function playTone(letter) {
      if (!soundEnabled) return;
      
      const frequencies = {
        'A': 261.63, 'B': 277.18, 'C': 293.66, 'D': 311.13, 'E': 329.63,
        'F': 349.23, 'G': 369.99, 'H': 392.00, 'I': 415.30, 'J': 440.00,
        'K': 466.16, 'L': 493.88, 'M': 523.25, 'N': 554.37, 'O': 587.33,
        'P': 622.25, 'Q': 659.25, 'R': 698.46, 'S': 739.99, 'T': 783.99,
        'U': 830.61, 'V': 880.00, 'W': 932.33, 'X': 987.77, 'Y': 1046.50,
        'Z': 1108.73, 'SPACE': 180
      };

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.frequency.value = frequencies[letter] || 440;
      osc.type = 'sine';

      gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);

      osc.start(audioCtx.currentTime);
      osc.stop(audioCtx.currentTime + 0.25);
    }

    function speakLetter(letter) {
      if (!soundEnabled || !letterPhonetics[letter]) return;
      
      speechSynth.cancel();
      const utterance = new SpeechSynthesisUtterance(letterPhonetics[letter]);
      utterance.rate = 0.85;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
      utterance.lang = 'en-US';
      setTimeout(() => speechSynth.speak(utterance), 80);
    }

    function speakFullText(text) {
      if (!text.trim()) return;
      
      speechSynth.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      utterance.volume = 1.0;
      utterance.lang = 'en-US';
      speechSynth.speak(utterance);
    }

    function buildKeyboard() {
      keyboardLayout.forEach((row, index) => {
        const rowElement = document.getElementById(`row${index + 1}`);
        row.forEach(key => {
          const btn = document.createElement('button');
          btn.className = 'key-btn';
          btn.textContent = key === 'SPACE' ? ' ' : key === 'BACKSPACE' ? '‚å´' : key;
          btn.setAttribute('data-key', key);
          btn.setAttribute('aria-label', key === 'BACKSPACE' ? 'Backspace' : key === 'SPACE' ? 'Space' : `Letter ${key}`);
          
          if (key === 'SPACE') {
            btn.classList.add('space-key');
          } else if (key === 'BACKSPACE') {
            btn.classList.add('backspace-key');
          }

          btn.addEventListener('click', () => pressKey(key, btn));
          rowElement.appendChild(btn);
        });
      });
    }

    function pressKey(key, btnElement) {
      btnElement.classList.add('pressed-animation');
      setTimeout(() => btnElement.classList.remove('pressed-animation'), 150);

      if (key === 'BACKSPACE') {
        currentText = currentText.slice(0, -1);
        updateDisplay();
        return;
      }

      const char = key === 'SPACE' ? ' ' : key;
      currentText += char;
      updateDisplay();
      
      playTone(key);
      speakLetter(key);
    }

    function updateDisplay() {
      document.getElementById('typedContent').textContent = currentText;
    }

    function clearAllText() {
      currentText = '';
      updateDisplay();
    }


    document.getElementById('speakBtn').addEventListener('click', () => {
      speakFullText(currentText);
    });

    document.getElementById('clearBtn').addEventListener('click', clearAllText);

    document.addEventListener('keydown', (e) => {
      const key = e.key.toUpperCase();
      if (key === 'BACKSPACE') {
        e.preventDefault();
        const btn = document.querySelector('[data-key="BACKSPACE"]');
        if (btn) pressKey('BACKSPACE', btn);
      } else if (key === ' ') {
        e.preventDefault();
        const btn = document.querySelector('[data-key="SPACE"]');
        if (btn) pressKey('SPACE', btn);
      } else if (/^[A-Z]$/.test(key)) {
        const btn = document.querySelector(`[data-key="${key}"]`);
        if (btn) pressKey(key, btn);
      }
    });

    async function onConfigChange(config) {
      const baseFont = config.font_family || defaultConfig.font_family;
      const fontStack = `${baseFont}, Arial, sans-serif`;
      const baseSize = config.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = fontStack;
      
      const mainContainer = document.getElementById('mainContainer');
      mainContainer.style.background = config.background_color || defaultConfig.background_color;

      const displaySection = document.getElementById('displaySection');
      displaySection.style.background = config.surface_color || defaultConfig.surface_color;
      displaySection.style.borderColor = config.text_color || defaultConfig.text_color;

      const typedContent = document.getElementById('typedContent');
      typedContent.style.color = config.text_color || defaultConfig.text_color;
      typedContent.style.background = config.background_color || defaultConfig.background_color;
      typedContent.style.borderColor = config.text_color || defaultConfig.text_color;
      typedContent.style.fontSize = `${baseSize * 3.5}px`;

      const speakBtn = document.getElementById('speakBtn');
      speakBtn.textContent = 'üîä';
      speakBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      speakBtn.style.color = config.text_color || defaultConfig.text_color;
      speakBtn.style.borderColor = config.text_color || defaultConfig.text_color;
      speakBtn.style.fontSize = `${baseSize * 2}px`;

      const clearBtn = document.getElementById('clearBtn');
      clearBtn.textContent = 'üóëÔ∏è';
      clearBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
      clearBtn.style.color = config.text_color || defaultConfig.text_color;
      clearBtn.style.borderColor = config.text_color || defaultConfig.text_color;
      clearBtn.style.fontSize = `${baseSize * 2}px`;

      const keyboardSection = document.getElementById('keyboardSection');
      keyboardSection.style.background = config.surface_color || defaultConfig.surface_color;

      document.querySelectorAll('.key-btn').forEach(key => {
        key.style.background = config.background_color || defaultConfig.background_color;
        key.style.color = config.text_color || defaultConfig.text_color;
        key.style.borderColor = config.text_color || defaultConfig.text_color;
        key.style.fontSize = `${baseSize * 3.25}px`;
      });

      document.querySelectorAll('.key-btn.backspace-key').forEach(key => {
        key.style.fontSize = `${baseSize * 2.5}px`;
      });
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['clear_button_text', config.clear_button_text || defaultConfig.clear_button_text],
          ['sound_toggle_on', config.sound_toggle_on || defaultConfig.sound_toggle_on],
          ['sound_toggle_off', config.sound_toggle_off || defaultConfig.sound_toggle_off],
          ['speak_button_text', config.speak_button_text || defaultConfig.speak_button_text]
        ])
      });
    }

    buildKeyboard();
    onConfigChange(defaultConfig);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2fb5a9610c7f8b',t:'MTc2NjU3NTIyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>




